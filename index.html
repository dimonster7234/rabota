<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Опросник Онлайн</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% {background-position: 0% 50%;}
            50% {background-position: 100% 50%;}
            100% {background-position: 0% 50%;}
        }

        header {
            background-color: rgba(0,0,0,0.6);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        h2 {
            color: #4A90E2;
        }
        .hidden {
            display: none;
        }
        input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #357ABD;
        }
        .question-block {
            margin-bottom: 20px;
        }
        label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <h1>Платформа для Онлайн-Опросов</h1>
    </header>
    <div class="container">
        <div id="authContainer">
            <h2>Вход</h2>
            <input type="text" id="loginUsername" placeholder="Логин">
            <input type="password" id="loginPassword" placeholder="Пароль">
            <button onclick="login()">Войти</button>
            <p>Нет аккаунта? <a href="#" onclick="showRegister()">Регистрация</a></p>
        </div>

        <div id="registerContainer" class="hidden">
            <h2>Регистрация</h2>
            <input type="text" id="registerUsername" placeholder="Логин">
            <input type="password" id="registerPassword" placeholder="Пароль">
            <button onclick="register()">Зарегистрироваться</button>
            <p>Есть аккаунт? <a href="#" onclick="showLogin()">Войти</a></p>
        </div>

        <div id="surveyContainer" class="hidden">
            <h2>Опросы</h2>
            <div id="surveyList"></div>
            <div id="takeSurveyContainer" class="hidden">
                <form id="takeSurveyForm"></form>
                <div id="thankYouMessage" class="hidden">Спасибо за участие!</div>
            </div>
        </div>

        <div id="adminPanel" class="hidden">
            <h2>Админ-панель</h2>
            <input type="text" id="newQuestion" placeholder="Введите вопрос">
            <textarea id="newOptions" placeholder="Варианты ответа (по одному в строке)"></textarea>
            <select id="newType">
                <option value="single">Один вариант</option>
                <option value="multiple">Несколько вариантов</option>
            </select>
            <button onclick="addQuestion()">Добавить вопрос</button>
            <div id="adminQuestions"></div>
            <button onclick="logout()">Выйти</button>
        </div>
    </div>

    <script>
        if (!localStorage.getItem('users')) {
            localStorage.setItem('users', JSON.stringify([{username: 'admin', password: 'admin123', role: 'admin'}]));
        }

        if (!localStorage.getItem('questions')) {
            localStorage.setItem('questions', JSON.stringify([]));
        }

        let currentUser = null;

        function showRegister() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('registerContainer').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('authContainer').classList.remove('hidden');
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                if (user.role === 'admin') showAdminPanel();
                else showSurvey();
            } else {
                alert('Неверный логин или пароль');
            }
        }

        function register() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            if (!username || !password) return alert('Заполните все поля');
            const users = JSON.parse(localStorage.getItem('users'));
            if (users.find(u => u.username === username)) return alert('Пользователь уже существует');
            users.push({username, password, role: 'user'});
            localStorage.setItem('users', JSON.stringify(users));
            alert('Регистрация успешна!');
            showLogin();
        }

        function showSurvey() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('surveyContainer').classList.remove('hidden');
            renderSurveyList();
        }

        function renderSurveyList() {
            const questions = JSON.parse(localStorage.getItem('questions'));
            const surveyList = document.getElementById('surveyList');
            surveyList.innerHTML = '';
            questions.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = 'question-block';
                div.innerHTML = `<strong>${q.text}</strong><br><button onclick="takeSurvey(${i})">Ответить</button>`;
                surveyList.appendChild(div);
            });
        }

        function takeSurvey(index) {
            const questions = JSON.parse(localStorage.getItem('questions'));
            const form = document.getElementById('takeSurveyForm');
            form.innerHTML = '';
            const q = questions[index];
            const title = document.createElement('h3');
            title.textContent = q.text;
            form.appendChild(title);
            q.options.forEach((opt, i) => {
                const label = document.createElement('label');
                label.innerHTML = `<input type="${q.type === 'multiple' ? 'checkbox' : 'radio'}" name="answer" value="${opt}"> ${opt}<br>`;
                form.appendChild(label);
            });
            const submit = document.createElement('button');
            submit.textContent = 'Отправить';
            submit.type = 'submit';
            form.appendChild(submit);
            form.onsubmit = function(e) {
                e.preventDefault();
                form.classList.add('hidden');
                document.getElementById('thankYouMessage').classList.remove('hidden');
            };
            document.getElementById('takeSurveyContainer').classList.remove('hidden');
        }

        function showAdminPanel() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            renderAdminQuestions();
        }

        function renderAdminQuestions() {
            const questions = JSON.parse(localStorage.getItem('questions'));
            const adminArea = document.getElementById('adminQuestions');
            adminArea.innerHTML = '';
            questions.forEach((q, i) => {
                const div = document.createElement('div');
                div.innerHTML = `<strong>${q.text}</strong><br>Тип: ${q.type}, Варианты: ${q.options.join(', ')}<br>
                    <button onclick="editQuestion(${i})">Редактировать</button> 
                    <button onclick="deleteQuestion(${i})">Удалить</button><hr>`;
                adminArea.appendChild(div);
            });
        }

        function addQuestion() {
            const text = document.getElementById('newQuestion').value;
            const optionsRaw = document.getElementById('newOptions').value;
            const type = document.getElementById('newType').value;
            const options = optionsRaw.split('\n').map(s => s.trim()).filter(s => s);
            if (!text || options.length === 0) return alert('Заполните вопрос и хотя бы один вариант');
            const questions = JSON.parse(localStorage.getItem('questions'));
            questions.push({text, options, type});
            localStorage.setItem('questions', JSON.stringify(questions));
            renderAdminQuestions();
        }

        function editQuestion(index) {
            const questions = JSON.parse(localStorage.getItem('questions'));
            const q = questions[index];
            const newText = prompt('Измените текст вопроса:', q.text);
            const newOpts = prompt('Измените варианты (через \n):', q.options.join('\n'));
            const newType = prompt('Тип (single/multiple):', q.type);
            if (newText && newOpts && newType) {
                questions[index] = {text: newText, options: newOpts.split('\n').map(x => x.trim()), type: newType};
                localStorage.setItem('questions', JSON.stringify(questions));
                renderAdminQuestions();
            }
        }

        function deleteQuestion(index) {
            const questions = JSON.parse(localStorage.getItem('questions'));
            questions.splice(index, 1);
            localStorage.setItem('questions', JSON.stringify(questions));
            renderAdminQuestions();
        }

        function logout() {
            location.reload();
        }
    </script>
</body>
</html>
