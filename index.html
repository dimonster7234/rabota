<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Супер-Опросник</title>
  <style>
    body {
      margin: 0;
      font-family: 'Comic Sans MS', sans-serif;
      background: linear-gradient(-45deg, #ff6ec4, #7873f5, #4adede, #ffb347);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: white;
      overflow-x: hidden;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 900px;
      margin: auto;
      padding: 2rem;
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
    }

    .button {
      background-color: #ffcc00;
      color: black;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin-right: 0.5rem;
    }

    .button:hover {
      background-color: #ffaa00;
    }

    .input, .textarea {
      width: 100%;
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: none;
      margin-bottom: 1rem;
      font-family: inherit;
    }

    .particles {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.3);
      animation: float 10s infinite ease-in-out;
    }

    @keyframes float {
      0%   { transform: translateY(0); }
      50%  { transform: translateY(-30px); }
      100% { transform: translateY(0); }
    }

    .question-block { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <div class="container">
    <div class="card">
      <h1>Супер-Опросник</h1>
      <div id="app"></div>
    </div>
  </div>

  <script>
    const app = document.getElementById("app");

    const state = {
      page: 'auth',
      user: null,
      users: JSON.parse(localStorage.getItem("users") || '{}'),
      surveys: JSON.parse(localStorage.getItem("surveys") || "[]"),
      answers: {},
      currentSurvey: null,
      editingSurveyIndex: null
    };

    function saveState() {
      localStorage.setItem("users", JSON.stringify(state.users));
      localStorage.setItem("surveys", JSON.stringify(state.surveys));
    }

    function renderAuthPage() {
      app.innerHTML = `
        <h3>Регистрация</h3>
        <input class="input" id="regLogin" placeholder="Логин" />
        <input class="input" type="password" id="regPass" placeholder="Пароль" />
        <button class="button" onclick="register()">Зарегистрироваться</button>
        <hr/>
        <h3>Вход</h3>
        <input class="input" id="login" placeholder="Логин" />
        <input class="input" type="password" id="password" placeholder="Пароль" />
        <button class="button" onclick="login()">Войти</button>
      `;
    }

    function register() {
      const login = document.getElementById("regLogin").value;
      const password = document.getElementById("regPass").value;
      if (!login || !password) return alert("Введите логин и пароль");
      if (state.users[login]) return alert("Пользователь уже существует");
      state.users[login] = { password, role: login === 'admin' ? 'admin' : 'user' };
      saveState();
      alert("Регистрация успешна. Теперь войдите.");
    }

    function login() {
      const login = document.getElementById("login").value;
      const password = document.getElementById("password").value;
      if (state.users[login] && state.users[login].password === password) {
        state.user = login;
        state.page = "home";
        render();
      } else {
        alert("Неверные данные");
      }
    }

    function logout() {
      state.user = null;
      state.page = 'auth';
      render();
    }

    function renderHome() {
      const role = state.users[state.user].role;
      let html = `<p>Добро пожаловать, ${state.user}! <button class='button' onclick='logout()'>Выйти</button></p>`;
      if (role === "admin") {
        html += `<button class="button" onclick="renderSurveyEditor()">Создать опрос</button>`;
      }
      state.surveys.forEach((s, i) => {
        html += `<div class='card'>
          <h2 onclick="startSurvey(${i})">${s.title}</h2>
          ${role === "admin" ? `<button class='button' onclick="editSurvey(${i})">Редактировать</button><button class='button' onclick="deleteSurvey(${i})">Удалить</button>` : ""}
        </div>`;
      });
      app.innerHTML = html;
    }

    function startSurvey(index) {
      state.currentSurvey = state.surveys[index];
      state.page = "survey";
      state.answers = {};
      render();
    }

    function renderSurvey() {
      let html = `<h2>${state.currentSurvey.title}</h2>`;
      state.currentSurvey.questions.forEach((q, i) => {
        html += `<div class='question-block'><p>${q}</p><textarea class="textarea" onchange="state.answers[${i}] = this.value"></textarea></div>`;
      });
      html += `<button class="button" onclick="submitSurvey()">Отправить</button>`;
      app.innerHTML = html;
    }

    function submitSurvey() {
      alert("Спасибо за участие!");
      state.page = "home";
      render();
    }

    function deleteSurvey(index) {
      if (confirm("Удалить опрос?")) {
        state.surveys.splice(index, 1);
        saveState();
        render();
      }
    }

    function editSurvey(index) {
      state.editingSurveyIndex = index;
      renderSurveyEditor(state.surveys[index]);
    }

    function renderSurveyEditor(survey = null) {
      const isEditing = !!survey;
      const title = survey ? survey.title : "";
      const questions = survey ? survey.questions.join("\n") : "";
      app.innerHTML = `
        <h3>${isEditing ? 'Редактировать' : 'Создать'} опрос</h3>
        <input class="input" id="surveyTitle" placeholder="Название опроса" value="${title}" />
        <textarea class="textarea" id="surveyQuestions" placeholder="Каждый вопрос с новой строки">${questions}</textarea>
        <button class="button" onclick="saveSurvey(${isEditing})">Сохранить</button>
        <button class="button" onclick="renderHome()">Отмена</button>
      `;
    }

    function saveSurvey(isEditing) {
      const title = document.getElementById("surveyTitle").value.trim();
      const questions = document.getElementById("surveyQuestions").value.trim().split("\n").map(q => q.trim()).filter(q => q);
      if (!title || questions.length === 0) return alert("Введите заголовок и хотя бы один вопрос.");
      const surveyData = { title, questions };
      if (isEditing && state.editingSurveyIndex !== null) {
        state.surveys[state.editingSurveyIndex] = surveyData;
        state.editingSurveyIndex = null;
      } else {
        state.surveys.push(surveyData);
      }
      saveState();
      renderHome();
    }

    function render() {
      if (state.page === "auth") renderAuthPage();
      else if (state.page === "home") renderHome();
      else if (state.page === "survey") renderSurvey();
    }

    const particlesContainer = document.getElementById("particles");
    for (let i = 0; i < 50; i++) {
      const p = document.createElement("div");
      p.className = "particle";
      p.style.top = Math.random() * 100 + "%";
      p.style.left = Math.random() * 100 + "%";
      p.style.animationDuration = (10 + Math.random() * 10) + "s";
      particlesContainer.appendChild(p);
    }

    render();
  </script>
</body>
</html>